@page "/documents"
@using CWDocMgrBlazor.Client.Shared
@using Microsoft.AspNetCore.Authorization
@using SharedLib.Models
@inject HttpClient Http
@inject AuthenticationStateProvider AuthStateProvider

@attribute [Authorize]

<NavLink class="btn btn-primary action-button" href="/document/upload">
    Upload Document
</NavLink>

<DocumentList Documents="documents"></DocumentList>

@code {
    List<DocumentVM> documents = new();

    protected override async Task OnInitializedAsync()
    {
        try
        {
            AuthenticationState authState = await AuthStateProvider.GetAuthenticationStateAsync();
            if (authState.User.Identity?.IsAuthenticated == true && Http.BaseAddress != null)
            {
                Console.WriteLine($"HttpClient.BaseAddress: {Http.BaseAddress}");
                documents = await Http.GetFromJsonAsync<List<DocumentVM>>("api/documents") ?? new();
            }
        }
        catch (HttpRequestException ex)
        {
            Console.WriteLine($"Error fetching documents: {ex.Message}");
            documents = new();
        }
    }

}
